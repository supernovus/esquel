Oharem -- A future DB ORM project using Esquel::DBI as its foundation.

The best way to describe what it will look like, is to show an example.

  class User does Oharem::Row {

    use JSON::Tiny;

    ## Rules:
    ##  primary  -- Use this in the WHERE clause to update records.
    ##  auto     -- This will be generated by the DB on first creation.
    ##  load     -- Call self.load-$name($field-from-db) to populate $!name
    ##  save     -- Call self.save-$name() to save the 'name' field to the DB.
    has %!DB-rules = {
      id      => { :primary, :auto },
      details => { :load, :store },  
    }

    ## Any attribute that doesn't start with DB will be considered a
    ## database field. So a field of 'id' will be $.id, and so forth.
    ## The Primary field should be readonly.
    has $.id;              ## Primary key, as per rules above.
    has $.name    is rw;   ## The user's real name.
    has $.age     is rw;   ## The user's age, in years.
    has $.month   is rw;   ## The user's birth month.
    has $.day     is rw;   ## The user's birth day.
    has $.details is rw;   ## Extra details, as a Hash.

    ## We store details as a JSON string.
    method load-details ($json) {
      from-json($json);
    }
    method save-details {
      to-json($!details);
    }

    ## We calculate the year based on age.
    method year {
      Date.today.year - $!age;
    }

  }

  class Users does Oharem::Table {

    has $!rows  = User;      ## The class to be used for Rows.
    has $.table = 'users';   ## The database table this represents.

  }

  ## Must be passed a DBH object from a DBI-compatible library.
  my $users = Users.new($dbh);
  my $date = Date.now;
  my @bdays = $users.get(:month($date.month), :day($date.day));
  for @bdays -> $user {
    $user.age++;
    say "Happy birthday {$user.name}, born today back in {$user.year}!";
    $user.save; ## Save the changes we made.
  }
  ## Okay, now let's create a user:
  my $newuser = User.new(:name<Tim>, :age<32>, :month(6), :day(22));
  $newuser.details = { src => 'https://github.com/supernovus' };
  $users.add: $newuser;

You get the idea.

